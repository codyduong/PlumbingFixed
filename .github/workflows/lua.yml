name: Validate Lua

on:
  push:
    paths:
      - '.github/workflows/lua.yml'
      - '**.lua'
    branches:
      - master
  pull_request:
    paths:
      - '.github/workflows/lua.yml'
      - '**.lua'
    branches:
      - master

jobs:
  emmylua:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: Cache Cargo registry
        uses: actions/cache@v3
        with:
          path: ~/.cargo/registry
          key: ${{ runner.os }}-cargo-registry-${{ hashFiles('**/Cargo.lock') }}
          restore-keys: |
            ${{ runner.os }}-cargo-registry-

      - name: Install EmmyLua Check
        run: cargo install emmylua_check

      - name: Validate Lua Files
        working-directory: .
        run: emmylua_check . -c .emmyrc.json

  stylua:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Stylua
        uses: JohnnyMorganz/stylua-action@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          version: v2.3.1
          args: --check --syntax Lua51 .